<!-- clueless/templates/clueless/index.html -->
{% extends 'clueless/base.html' %}
{% load static %}

{% block content %}

<!-- Set session var for char_id -->

{% if char_id %}
    <script>
        sessionStorage.setItem('char_id', {{ char_id }});
    </script>
{% endif %}

<!-- Main Content -->
    <div class="container mx-auto">
      <div class="grid grid-cols-3">
          <div class="col-span-2">
              <div class="label">
                  <span class="text-xl">
                      What would you like to do:
                  </span>
              </div>
              <select id="player-select" class="select select-primary w-full max-w-xs" control-id="ControlID-1">
                  <option value="Move to Study">Move to Study</div>
                  <option value="Move to Ballroom">Move to Ballroom</div>
                  <option value="Move to Billiards">Move to Billiards Room</div>
                  <option value="Move to Dining Room">Move to Dining Room</div>
                  <option value="Move to Hallway">Move to Hall</div>
                  <option value="Move to Kitchen">Move to Kitchen</div>
                  <option value="Move to Lounge">Move to Lounge</div>
                  <option value="Move to Conservatory">Move to Conservatory</div>
                  <option value="Move to Library">Move to Library</div>
                  <option value="action item">Make a Suggestion</div>
                  <option value="action item">Make an Accusation</div>
              </select>
              <div class="label">
                  <button id="player-turn" class="btn btn-neutral"> Select Action </button>
              </div>
              <div id="game board" class="grid grid-rows-3 grid-flow-col gap-5 font-mono text-white text-sm text-center font-bold leading-6 rounded-lg">
                <div class="p-20 rounded-lg shadow-lg bg-blue-500">Study</div>
                <div class="p-20 rounded-lg shadow-lg bg-blue-500">Ballroom</div>
                <div class="p-20 rounded-lg shadow-lg bg-blue-500">Billiards Room</div>
                <div class="p-20 rounded-lg shadow-lg bg-blue-500">Dining Room</div>
                <div class="p-20 rounded-lg shadow-lg bg-blue-500">Hall</div>
                <div class="p-20 rounded-lg shadow-lg bg-blue-500">Kitchen</div>
                <div class="p-20 rounded-lg shadow-lg bg-blue-500">Lounge</div>
                <div class="p-20 rounded-lg shadow-lg bg-blue-500">Conservatory</div>
                <div class="p-20 rounded-lg shadow-lg bg-blue-500">Library</div>
              </div>
          </div>
          <div class="col-span-1">
  
            <div id="player-log" class="container mx-auto overflow-auto max-h-dvh">
                <div class="label">
                    <span class="text-xl"> Game Log </span>
                </div>
                <!-- Render game log messages from javascript -->

            </div>
          </div>
      </div>
  </div>

  {% endblock %}
  
  {% block script %}

<script>
   
    const activitySocket = new WebSocket(
        'ws://'
        + window.location.host
        + '/ws/clueless/gameplay/'
    );

    activitySocket.onmessage = function (e) {
        const data = JSON.parse(e.data);
        console.log(data);
        const playerLog = document.querySelector('#player-log');
        if (data.message == "player_turn") {
            // Enable the "Player Turn" button
            const startGameButton = document.querySelector('#player-turn');
            startTurnButton.disabled = false;
            startTurnButton.classList.remove('btn-disabled');
            startTurnButton.classList.add('btn');
        }
    };

    activitySocket.onclose = function (e) {
        console.error('Chat socket closed unexpectedly');
    }

    activitySocket.onmessage = function(e) {
        const data = JSON.parse(e.data);
        const playerLog = document.querySelector('#player-log');
        playerLog.innerHTML += '<div class="chat chat-end"><div class="chat-bubble">' + data.message + '</div></div>';
        playerLog.scrollTop = playerLog.scrollHeight;
    };

    document.querySelector('#action-select').onclick = function() {
        const action = document.querySelector('#player-select').value;
        {% comment %} const charID = sessionStorage.getItem('char_id'); {% endcomment %}

        activitySocket.send(JSON.stringify({
            'message': "Selected " + action
        }));
    };



</script>

{% endblock %}
        